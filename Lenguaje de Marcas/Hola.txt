<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="2.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    
    <xsl:output method="html" indent="yes" />

    <xsl:template match="/">
        <html>
            <head>
                <title>Reporte de Productos - Agrupados por Categoría (XSLT 2.0)</title>
                <style>
                    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
                    table { width: 60%; margin: auto; border-collapse: collapse; margin-bottom: 20px; }
                    th, td { border: 1px solid black; padding: 8px; text-align: center; }
                    th { background-color: #f2f2f2; }
                    .rojo { color: red; font-weight: bold; }
                    .verde { color: green; font-weight: bold; }
                    .categoria { font-size: 22px; font-weight: bold; margin-top: 20px; text-align: center; }
                    .titulo { font-size: 24px; font-weight: bold; margin-bottom: 20px; }
                    .resumen { font-size: 18px; font-weight: bold; margin-top: 10px; }
                    .final { font-size: 20px; font-weight: bold; margin-top: 30px; }
                </style>
            </head>
            <body>
                <div class="titulo">Reporte de Productos Agrupados por Categoría (XSLT 2.0)</div>

                <xsl:for-each-group select="productos/producto" group-by="categoria">
                    <div class="categoria">Categoría: <xsl:value-of select="current-grouping-key()"/></div>
                    
                    <table>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Stock</th>
                        </tr>
                        <xsl:for-each select="current-group()">
                            <xsl:sort select="precio" data-type="number" order="ascending"/>
                            <tr>
                                <td><xsl:value-of select="@id"/></td>
                                <td><xsl:value-of select="nombre"/></td>
                                <td>
                                    <xsl:choose>
                                        <xsl:when test="precio &gt; 500">
                                            <span class="rojo"><xsl:value-of select="precio"/></span>
                                        </xsl:when>
                                        <xsl:when test="precio &lt; 200">
                                            <span class="verde"><xsl:value-of select="precio"/></span>
                                        </xsl:when>
                                        <xsl:otherwise>
                                            <xsl:value-of select="precio"/>
                                        </xsl:otherwise>
                                    </xsl:choose>
                                </td>
                                <td><xsl:value-of select="stock"/></td>
                            </tr>
                        </xsl:for-each>
                    </table>
                    
                    <div class="resumen">
                        Total productos: <xsl:value-of select="count(current-group())"/> | 
                        Stock total: <xsl:value-of select="sum(current-group()/stock)"/>
                    </div>
                </xsl:for-each-group>

                <div class="final">Fin del reporte</div>
            </body>
        </html>
    </xsl:template>

</xsl:stylesheet>
